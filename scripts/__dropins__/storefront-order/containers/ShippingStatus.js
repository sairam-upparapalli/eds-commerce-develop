import{jsxs as t,jsx as n,Fragment as b}from"@dropins/tools/preact-jsx-runtime.js";import{classes as y,Slot as L}from"@dropins/tools/lib.js";import{Card as N,Header as _,Accordion as A,AccordionSection as x,ContentGrid as V,Image as o}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{useState as B,useEffect as J}from"@dropins/tools/preact-hooks.js";import{events as K}from"@dropins/tools/event-bus.js";import{u as Q}from"../chunks/useIsMobile.js";import{Text as E,useText as X}from"@dropins/tools/i18n.js";import{C as Z}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/preact.js";var $=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))($||{});const Y=({orderData:e})=>{const[h,i]=B(e);return J(()=>{const d=K.on("order/data",c=>{i(c)},{eager:!0});return()=>{d==null||d.off()}},[]),{order:h}},P=({slots:e,collapseThreshold:h,translations:i,returnData:d,routeTracking:c,routeProductDetails:m})=>{var u;const C=Q(),f=m?"a":"span";return t(N,{variant:"secondary",className:y(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[n(_,{title:i.returnOrderCardTitle}),t("div",{children:[(u=d==null?void 0:d.tracking)==null?void 0:u.map((r,S)=>{var a,p;return t("p",{children:[`${i.carrier} ${(p=(a=r==null?void 0:r.carrier)==null?void 0:a.label)==null?void 0:p.toLocaleUpperCase()}: `,n("a",{href:`${(c==null?void 0:c(r))??"#"}`,rel:"noreferrer",children:r.trackingNumber})]},`${r.trackingNumber}_${S}`)}),e!=null&&e.ReturnItemsDetails?n(L,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:d.items}}):null,n(A,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(x,{defaultOpen:h>=d.items.length,title:n(E,{id:"Order.ShippingStatusCard.itemText",plural:d.items.length,fields:{count:d.items.length}}),children:n(V,{maxColumns:C?3:9,emptyGridContent:n(b,{}),className:y(["order-shipping-status-card__images",["order-shipping-status-card__images-3",C]]),children:d.items.map((r,S)=>{var I,T;const a=(I=r.thumbnail)==null?void 0:I.label,p=(T=r.thumbnail)==null?void 0:T.url;return n(f,{href:(m==null?void 0:m(r))??"#","data-testid":`${S}${r.uid}`,children:n(o,{alt:a,src:p,width:85,height:114})},`${S}${r.uid}`)})})})})]})]})},k=({translations:e,slots:h,orderData:i,collapseThreshold:d=10,routeProductDetails:c,routeTracking:m})=>{var I,T,R,w,G;const C=!!(i!=null&&i.returnNumber),f=i==null?void 0:i.returnNumber,u=c?"a":"span",r=(I=i==null?void 0:i.status)==null?void 0:I.toLocaleLowerCase(),a=((T=i==null?void 0:i.shipments)==null?void 0:T.length)===1&&(r==null?void 0:r.includes($.COMPLETE)),p=(R=i==null?void 0:i.items)==null?void 0:R.filter(g=>(g==null?void 0:g.quantityShipped)===0);if(C&&(i!=null&&i.returns.length)){const g=i.returns.find(s=>s.returnNumber===f);return n(b,{children:g&&g.tracking.length>0?n(P,{slots:h,collapseThreshold:d,translations:e,returnData:g,routeTracking:m,routeProductDetails:c}):null})}return!i||r!=null&&r.includes($.CANCELED)?null:(w=i==null?void 0:i.shipments)!=null&&w.length?t(b,{children:[(G=i==null?void 0:i.shipments)==null?void 0:G.map(({tracking:g,items:s,id:O},W)=>t(N,{variant:"secondary",className:"order-shipping-status-card",children:[n(_,{title:e.shippingCardTitle}),g==null?void 0:g.map(l=>{var v;return t("div",{className:"order-shipping-status-card__header",role:"status",children:[t("div",{className:"order-shipping-status-card__header--content",children:[t("p",{children:[e.carrier," ",(v=l==null?void 0:l.carrier)==null?void 0:v.toLocaleUpperCase()," | ",l==null?void 0:l.number]}),n("p",{children:l==null?void 0:l.title})]}),h!=null&&h.DeliveryTrackActions?n(L,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:h==null?void 0:h.DeliveryTrackActions,context:{trackInformation:l}}):null]},l.number)}),a?null:n(A,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(x,{"data-position":W+1,defaultOpen:d>=(s==null?void 0:s.length),title:n(b,{children:n(E,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:s==null?void 0:s.length,fields:{count:s==null?void 0:s.length}})}),children:n(V,{maxColumns:6,emptyGridContent:n(b,{}),className:"order-shipping-status-card__images",children:s==null?void 0:s.map(l=>{var M,U,H,j,F,q;const v=(H=(U=(M=l==null?void 0:l.orderItem)==null?void 0:M.product)==null?void 0:U.thumbnail)==null?void 0:H.label,z=(q=(F=(j=l==null?void 0:l.orderItem)==null?void 0:j.product)==null?void 0:F.thumbnail)==null?void 0:q.url;return n(u,{href:(c==null?void 0:c(l))??"#",children:n(o,{alt:v,src:z||"",width:85,height:114})},l.id)})})})}),h!=null&&h.DeliveryTimeLine?n(L,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:h==null?void 0:h.DeliveryTimeLine,context:{}}):null]},O)),p!=null&&p.length?t(N,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[n(_,{title:e.notYetShippedTitle}),n(A,{actionIconPosition:"right",children:n(x,{defaultOpen:d>=(p==null?void 0:p.length),title:n(E,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:p==null?void 0:p.length,fields:{count:p==null?void 0:p.length}}),children:n("div",{className:"order-shipping-status-card__images",children:p==null?void 0:p.map(g=>{var s,O;return n(u,{href:(c==null?void 0:c(g))??"#",children:n(o,{alt:(s=g.thumbnail)==null?void 0:s.label,src:((O=g.thumbnail)==null?void 0:O.url)||"",width:85,height:114})},g.id)})})})})]}):null]}):t(N,{variant:"secondary",className:"order-shipping-status-card",children:[n(_,{title:e.shippingInfoTitle}),n("div",{className:"order-shipping-status-card__header",children:t("div",{className:"order-shipping-status-card__header--content",children:[i!=null&&i.carrier?n("p",{children:i==null?void 0:i.carrier}):null,n("p",{children:e.noInfoTitle})]})})]})},gi=({slots:e,className:h,collapseThreshold:i,orderData:d,routeOrderDetails:c,routeTracking:m,routeProductDetails:C})=>{const{order:f}=Y({orderData:d}),u=X({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return n("div",{className:y(["order-shipping-status",h]),children:f?n(k,{translations:u,routeOrderDetails:c,routeTracking:m,slots:e,orderData:f,collapseThreshold:i,routeProductDetails:C}):n(Z,{withCard:!1})})};export{gi as ShippingStatus,gi as default};
