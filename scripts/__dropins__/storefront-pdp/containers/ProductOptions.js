import{jsx as j}from"@dropins/tools/preact-jsx-runtime.js";import{useState as h,useEffect as L,useCallback as w}from"@dropins/tools/preact-compat.js";import{Slot as R}from"@dropins/tools/lib.js";import{events as d}from"@dropins/tools/event-bus.js";import"@dropins/tools/components.js";/* empty css             */import{S as q}from"../chunks/Swatches.js";import"@dropins/tools/preact.js";import{c as z,j as A,h as G,p as H}from"../chunks/fetchPDPData.js";import{g as C,s as y}from"../chunks/getProductConfigurationValues.js";import{s as g}from"../chunks/isProductConfigurationValid.js";import{g as J}from"../chunks/getFetchedProductData.js";import"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const K=({initialData:p={data:null,optionsUIDs:[]},hideSelectedValue:I=!1,slots:l,onValues:f,onErrors:u,children:N,...v})=>{const[o,O]=h(p.data),[n,b]=h(p.optionsUIDs),[B,M]=h();L(()=>{const i=d.on("pdp/data",O),r=d.on("pdp/values",({optionsUIDs:a})=>{a&&b(a)});return g(()=>o!=null&&o.options?(n==null?void 0:n.length)===o.options.length:!0),()=>{i==null||i.off(),r==null||r.off()}},[]);const T=w(async i=>{var P,D,S,U,k;if(!(o!=null&&o.sku))return;const{persistURLParams:r,anchors:a,acdl:F}=z.getConfig();let s=Object.keys(i).map(t=>i[t].value).filter(t=>t!==void 0);if(r&&((P=o==null?void 0:o.options)!=null&&P.some(c=>(c==null?void 0:c.typename)==="ProductViewOptionValueProduct")||A({optionsUIDs:s.join(",")})),((S=(D=C())==null?void 0:D.optionsUIDs)==null?void 0:S.join("|"))!==(s==null?void 0:s.join("|"))){y(e=>({...e,optionsUIDs:s})),f==null||f(s);const t=await G(o.sku,{optionsUIDs:s});d.emit("pdp/data",t);let c=(s==null?void 0:s.length)===((U=t==null?void 0:t.options)==null?void 0:U.length);if(a!=null&&a.length){const e=(t==null?void 0:t.optionUIDs)??[];s.every(m=>e.includes(m))||(M(t==null?void 0:t.options),y(m=>({...m,optionsUIDs:e})),c=(e==null?void 0:e.length)===((k=t==null?void 0:t.options)==null?void 0:k.length))}g(()=>c),F&&t&&(t==null?void 0:t.variantSku)!==o.sku&&H(t)}},[o==null?void 0:o.options,o==null?void 0:o.sku,f]),V=w(i=>{Object.keys(i).length!==0&&(g(()=>!1),u==null||u(i))},[u]);return!o||!o.options?null:j(R,{name:"Swatches",slot:l==null?void 0:l.Swatches,context:{data:o,optionsUIDs:n},children:j(q,{...v,options:o.options,selectedUIDs:n,defaultOptions:n,selectionsToUpdate:B,hideSelectedValue:I,onValues:T,onErrors:V})})};K.getInitialData=async function(){var p;return{data:await J(),optionsUIDs:((p=C())==null?void 0:p.optionsUIDs)??[]}};export{K as ProductOptions,K as default};
